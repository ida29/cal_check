# Calorie Checker AI

AI画像認識を使用して、食べ物の写真から自動的にカロリーを計算し、栄養情報を提供するFlutterアプリケーションです。

## 機能

- 📸 **スマート食べ物認識**: 食事の写真を撮影するだけで、瞬時に食べ物を識別
- 🧮 **自動カロリー計算**: 正確なカロリー数と栄養成分の内訳を取得
- 📊 **進捗トラッキング**: 日次・週次の栄養目標を監視
- 🎯 **個人別目標設定**: プロフィールに基づいたカスタムカロリー目標の設定
- 📱 **オフライン対応**: インターネット接続なしでも基本機能が利用可能
- 📈 **統計と洞察**: 詳細なチャートと栄養に関する洞察を表示

## 動作手順

### アプリの使い方

1. **初期設定**
   - アプリを起動すると、オンボーディング画面が表示されます
   - 個人情報（名前、年齢、性別、身長、体重）を入力してください
   - 活動レベルを選択し、推奨カロリーを確認してください

2. **食事の記録**
   - ホーム画面の「Add Meal」ボタンまたは右下のカメラボタンをタップ
   - カメラ画面で食べ物の写真を撮影、またはギャラリーから選択
   - AI が自動的に食べ物を認識し、カロリーを計算します

3. **結果の確認と編集**
   - 認識結果画面で、検出された食べ物とカロリー情報を確認
   - 必要に応じて分量を調整したり、食べ物を追加・削除
   - 「Save」ボタンで食事記録を保存

4. **進捗の確認**
   - ホーム画面で当日のカロリー摂取量と目標の進捗を確認
   - 「History」タブで過去の食事記録を参照
   - 「Statistics」タブで詳細な統計とグラフを表示

5. **設定の変更**
   - 「Settings」タブで個人情報や目標カロリーを変更
   - 通知設定やアプリの環境設定を調整

### 開発環境のセットアップ

#### 前提条件

- Flutter SDK (>=3.0.0)
- Dart SDK (>=3.0.0)
- Android Studio または VS Code
- iOS/Android デバイスまたはエミュレータ

#### インストール手順

1. リポジトリをクローン:
```bash
git clone <repository-url>
```

2. 依存関係をインストール:
```bash
flutter pub get
```

3. コード生成（Freezedモデル用）:
```bash
flutter packages pub run build_runner build
```

4. アプリを実行:
```bash
flutter run
```

#### 初回起動時の注意点

- **権限の許可**: カメラとストレージへのアクセス権限を許可してください
- **ML Kitの初期化**: 初回起動時にGoogle ML Kitの初期化が行われるため、少し時間がかかる場合があります
- **データベースの作成**: 初回起動時に自動的にローカルデータベースが作成されます

## アーキテクチャ

このアプリは3層アーキテクチャパターンに従っています:

### プレゼンテーション層 (`lib/presentation/`)
- **Screens**: メインUIスクリーン (ホーム、カメラ、結果、履歴、統計、設定)
- **Widgets**: 再利用可能なUIコンポーネント
- **Controllers**: UIロジックと状態管理

### ビジネスロジック層 (`lib/business/`)
- **Services**: コアビジネスロジック (カメラ、画像認識、カロリー計算)
- **Providers**: Riverpod状態管理プロバイダー
- **Models**: ビジネスロジックモデルとDTO

### データ層 (`lib/data/`)
- **Entities**: コアデータモデル
- **Repositories**: データアクセスインターフェース
- **DataSources**: 具体的な実装 (SQLite、API)

## 主要な依存関係

- **flutter_riverpod**: 状態管理
- **sqflite**: ローカルデータベース
- **camera**: カメラ統合
- **google_mlkit_image_labeling**: AI画像認識
- **fl_chart**: チャートとグラフ
- **freezed**: イミュータブルデータクラス
- **json_annotation**: JSONシリアライゼーション

## データベーススキーマ

### ユーザーテーブル
- 個人情報（名前、年齢、性別、身長、体重）
- 活動レベルと目標カロリー
- アプリの設定

### 食事テーブル
- 食事メタデータ（タイムスタンプ、種類、画像パス）
- 総カロリーと栄養情報
- オフライン対応の同期ステータス

### 食べ物アイテムテーブル
- 食事内の個別の食べ物アイテム
- 分量、カロリー、栄養成分の詳細
- AIの信頼度スコア

### 食べ物データベーステーブル
- 事前入力済みの栄養データベース
- 一般的な食べ物のカロリー情報
- ユーザーが追加したカスタム食べ物

## 必要な権限

### Android
```xml
<uses-permission android:name="android.permission.CAMERA" />
<uses-permission android:name="android.permission.WRITE_EXTERNAL_STORAGE" />
<uses-permission android:name="android.permission.READ_EXTERNAL_STORAGE" />
<uses-permission android:name="android.permission.INTERNET" />
```

### iOS
```xml
<key>NSCameraUsageDescription</key>
<string>食事の写真を撮影するためにカメラへのアクセスが必要です</string>
<key>NSPhotoLibraryUsageDescription</key>
<string>食事画像を選択するためにフォトライブラリへのアクセスが必要です</string>
```

## トラブルシューティング

### よくある問題と解決方法

1. **カメラが起動しない**
   - デバイスの設定でカメラ権限が許可されているか確認
   - アプリを再起動してみる
   - デバイスを再起動してみる

2. **食べ物の認識精度が低い**
   - 明るい場所で撮影する
   - 食べ物を画面の中央に配置する
   - 影ができないように注意する
   - 複数の食べ物がある場合は、一つずつ撮影する

3. **アプリが重い・遅い**
   - 不要な写真データを削除する（設定画面から）
   - デバイスの空き容量を確認する
   - アプリのキャッシュをクリアする

4. **データが消えた**
   - ローカルデータベースに保存されているため、アプリを削除すると全データが消去されます
   - 定期的にデータのエクスポートを行うことを推奨します（今後の機能追加予定）

## テスト

テストを実行:
```bash
flutter test
```

テストカバレッジを生成:
```bash
flutter test --coverage
```

## ビルド

### Android
```bash
flutter build apk --release
# または
flutter build appbundle --release
```

### iOS
```bash
flutter build ios --release
```

## 今後の開発予定

### 近日追加予定の機能
- クラウド同期機能
- より多くの食べ物データベース
- 食事レシピの提案機能
- 他のヘルスケアアプリとの連携
- 多言語対応の拡張
- ダークモードの完全対応

### 既知の制限事項
- 画像認識の精度は光の条件と食べ物の種類に依存します
- 現在はオフライン使用のみ対応（クラウド同期は今後追加予定）
- 一部の食べ物で栄養情報が不正確な場合があります

## 貢献

1. リポジトリをフォーク
2. 機能ブランチを作成: `git checkout -b feature-name`
3. 変更をコミット: `git commit -am 'Add feature'`
4. ブランチにプッシュ: `git push origin feature-name`
5. プルリクエストを送信

## ライセンス

このプロジェクトはMITライセンスの下でライセンスされています - 詳細はLICENSEファイルを参照してください。

## サポート

サポートや質問については、リポジトリでIssueを開いてください。
