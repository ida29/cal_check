# 実装計画

- [ ] 1. プロジェクト初期設定とコア構造の構築

  - Flutter プロジェクトの作成と基本設定
  - 必要な依存関係の追加（riverpod, sqflite, camera, image 等）
  - フォルダ構造の作成（lib/presentation, lib/business, lib/data）
  - 基本的なルーティング設定
  - _要件: 全般的な基盤_

- [ ] 2. データモデルとエンティティの実装

  - [ ] 2.1 コアデータモデルクラスの作成

    - User, Meal, FoodItem, NutritionInfo クラスの実装
    - JSON シリアライゼーション機能の追加
    - データ検証ロジックの実装
    - _要件: 5.1, 5.2_

  - [ ] 2.2 データモデルのユニットテスト作成
    - 各モデルクラスのテストケース作成
    - シリアライゼーション/デシリアライゼーションのテスト
    - バリデーションロジックのテスト
    - _要件: 5.1, 5.2_

- [ ] 3. データベース層の実装

  - [ ] 3.1 SQLite データベーススキーマの実装

    - データベースヘルパークラスの作成
    - テーブル作成とマイグレーション機能
    - データベース接続管理の実装
    - _要件: 3.1, 3.2_

  - [ ] 3.2 リポジトリパターンの実装

    - MealRepository, UserRepository の基底インターフェース定義
    - SQLite を使用した具体的なリポジトリクラスの実装
    - CRUD 操作の実装とエラーハンドリング
    - _要件: 3.1, 3.2, 3.3_

  - [ ] 3.3 データベース操作のユニットテスト
    - リポジトリクラスのテストケース作成
    - データベース操作の正確性テスト
    - エラーケースのテスト
    - _要件: 3.1, 3.2, 3.3_

- [ ] 4. カメラ機能とファイル管理の実装

  - [ ] 4.1 カメラサービスの実装

    - CameraService クラスの作成
    - カメラ初期化と権限管理
    - 写真撮影とファイル保存機能
    - _要件: 1.1, 1.2_

  - [ ] 4.2 画像ファイル管理機能の実装

    - 画像ファイルの保存とパス管理
    - 画像リサイズとフォーマット最適化
    - ファイル削除とクリーンアップ機能
    - _要件: 1.1, 1.2_

  - [ ] 4.3 カメラ機能のテスト実装
    - CameraService のユニットテスト
    - ファイル操作のテストケース
    - 権限エラーのハンドリングテスト
    - _要件: 1.1, 1.2_

- [ ] 5. AI 画像認識機能の実装

  - [ ] 5.1 画像認識サービスの基盤実装

    - ImageRecognitionService インターフェースの定義
    - Google ML Kit または TensorFlow Lite の統合
    - 画像前処理とフォーマット変換
    - _要件: 1.2, 1.3_

  - [ ] 5.2 食材認識ロジックの実装

    - 食材検出と分類機能
    - 認識結果の信頼度評価
    - 複数食材の同時認識処理
    - _要件: 1.2, 1.3, 1.4_

  - [ ] 5.3 画像認識のテストとモック実装
    - 画像認識サービスのユニットテスト
    - テスト用のモック画像認識サービス
    - 認識精度のテストケース
    - _要件: 1.2, 1.3, 1.4_

- [ ] 6. カロリー計算機能の実装

  - [ ] 6.1 栄養データベースの構築

    - 基本的な食材の栄養情報データベース作成
    - 栄養情報検索とマッチング機能
    - カスタム食材の追加機能
    - _要件: 2.1, 2.2_

  - [ ] 6.2 カロリー計算サービスの実装

    - CalorieCalculationService クラスの作成
    - 食材別カロリー計算ロジック
    - 総カロリーと栄養素の集計機能
    - _要件: 2.1, 2.2, 2.3_

  - [ ] 6.3 分量調整機能の実装
    - 標準分量の設定と調整機能
    - ユーザーによる分量カスタマイズ
    - 分量変更に伴うカロリー再計算
    - _要件: 2.4_

- [ ] 7. 状態管理とプロバイダーの実装

  - [ ] 7.1 Riverpod プロバイダーの基盤実装

    - MealProvider, UserProvider の作成
    - 状態の初期化と更新ロジック
    - 非同期状態管理の実装
    - _要件: 全般的な状態管理_

  - [ ] 7.2 統計データプロバイダーの実装

    - StatisticsProvider の作成
    - 日次・週次データの集計ロジック
    - 目標との比較計算機能
    - _要件: 4.1, 4.2, 4.3_

  - [ ] 7.3 プロバイダーのテスト実装
    - 各プロバイダーのユニットテスト
    - 状態変更のテストケース
    - 非同期処理のテスト
    - _要件: 全般的な状態管理_

- [ ] 8. ユーザーインターフェースの実装

  - [ ] 8.1 ホーム画面の実装

    - HomeScreen ウィジェットの作成
    - カメラ撮影ボタンとナビゲーション
    - 最近の記録表示機能
    - _要件: 基本 UI_

  - [ ] 8.2 カメラ画面の実装

    - CameraScreen ウィジェットの作成
    - カメラプレビューとコントロール
    - 撮影ボタンと画像確認機能
    - _要件: 1.1, 1.2_

  - [ ] 8.3 結果表示画面の実装
    - ResultScreen ウィジェットの作成
    - 認識結果とカロリー情報の表示
    - 編集・保存ボタンの実装
    - _要件: 1.3, 2.1, 2.2, 2.3_

- [ ] 9. 食事記録と履歴機能の実装

  - [ ] 9.1 食事記録保存機能の実装

    - 食事データの保存処理
    - 画像ファイルとデータの関連付け
    - 保存成功・失敗の通知機能
    - _要件: 3.1_

  - [ ] 9.2 履歴画面の実装

    - HistoryScreen ウィジェットの作成
    - 食事記録一覧の表示機能
    - 日付フィルターと検索機能
    - _要件: 3.2, 3.3_

  - [ ] 9.3 記録削除機能の実装
    - 削除確認ダイアログの実装
    - 食事記録とファイルの削除処理
    - 削除後の UI 更新機能
    - _要件: 3.4_

- [ ] 10. 統計とグラフ機能の実装

  - [ ] 10.1 日次統計の実装

    - 当日のカロリー摂取量計算
    - 栄養バランスの表示機能
    - 目標との比較表示
    - _要件: 4.1, 4.3_

  - [ ] 10.2 週次統計とグラフの実装

    - 過去 7 日間のデータ集計
    - カロリー推移グラフの実装
    - 週間平均の計算と表示
    - _要件: 4.2_

  - [ ] 10.3 目標超過アラート機能の実装
    - 目標カロリー超過の検知
    - 警告メッセージの表示
    - 推奨アクションの提案機能
    - _要件: 4.4_

- [ ] 11. ユーザー設定機能の実装

  - [ ] 11.1 初期設定画面の実装

    - 初回起動時の設定ウィザード
    - 基本情報入力フォーム
    - 推奨カロリー計算機能
    - _要件: 5.1, 5.2_

  - [ ] 11.2 設定変更画面の実装

    - SettingsScreen ウィジェットの作成
    - ユーザー情報編集機能
    - 目標設定とカスタマイズ
    - _要件: 5.3, 5.4_

  - [ ] 11.3 設定データの永続化
    - 設定変更の保存処理
    - 設定に基づく計算の更新
    - 設定復元機能の実装
    - _要件: 5.4_

- [ ] 12. オフライン機能とデータ同期

  - [ ] 12.1 オフライン検知機能の実装

    - ネットワーク状態の監視
    - オフラインモードの切り替え
    - オフライン時の UI 調整
    - _要件: 6.1_

  - [ ] 12.2 オフラインデータ管理の実装

    - オフライン時のデータ一時保存
    - 同期待ちデータの管理
    - データ整合性の確保
    - _要件: 6.2_

  - [ ] 12.3 データ同期機能の実装
    - ネットワーク復旧時の自動同期
    - 同期エラーハンドリング
    - 再試行機能の実装
    - _要件: 6.3, 6.4_

- [ ] 13. エラーハンドリングと通知機能

  - [ ] 13.1 グローバルエラーハンドラーの実装

    - ErrorHandler クラスの作成
    - エラータイプ別の処理分岐
    - ユーザーフレンドリーなエラーメッセージ
    - _要件: エラーハンドリング全般_

  - [ ] 13.2 通知機能の実装
    - ローカル通知の設定
    - 成功・エラー通知の表示
    - 通知権限の管理
    - _要件: ユーザー体験向上_

- [ ] 14. 統合テストと E2E テスト

  - [ ] 14.1 主要フローの統合テスト

    - 写真撮影から保存までのフローテスト
    - データベース操作の統合テスト
    - 状態管理の統合テスト
    - _要件: 全体的な動作確認_

  - [ ] 14.2 ウィジェットテストの実装
    - 各画面のウィジェットテスト
    - ユーザーインタラクションのテスト
    - 状態変化のテスト
    - _要件: UI/UX の品質確保_

- [ ] 15. パフォーマンス最適化と最終調整

  - [ ] 15.1 画像処理の最適化

    - 画像サイズとメモリ使用量の最適化
    - 非同期処理の改善
    - キャッシュ機能の実装
    - _要件: パフォーマンス向上_

  - [ ] 15.2 アプリ全体の最終調整
    - UI/UX の微調整
    - エラーメッセージの多言語対応
    - アプリアイコンとスプラッシュ画面の設定
    - _要件: リリース準備_
